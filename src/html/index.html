<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Menu — Simulador de Juros Compostos</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.3/decimal.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css"
    rel="stylesheet"
/>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/modal.css">
</head>
<body>
<header class="header">
         <nav class="nav container">
            <div class="nav__data">
               <a href="#" class="nav__logo">
                  <i class="ri-planet-line"></i> JurosSim
               </a>

              <div class="nav__toggle" id="nav-toggle" aria-controls="nav-menu" aria-expanded="false" aria-label="Abrir menu">
                <i class="ri-menu-line nav__burger" aria-hidden="true"></i>
                <i class="ri-close-line nav__close" aria-hidden="true"></i>
              </div>
            </div>

            <!--=============== NAV MENU ===============-->
            <div class="nav__menu" id="nav-menu" role="navigation" aria-label="Navegação principal">
               <ul class="nav__list">
                  <li><a href="#" class="nav__link">Simulador</a></li>
                  <li><a href="#savedList" class="nav__link">Meus Cenários</a></li>
                  <li><a href="#" class="nav__link">Sobre</a></li>
               </ul>
            </div>
         </nav>
      </header>

<!-- Conteúdo de exemplo -->
<main id="mainContent" class="container" role="main" tabindex="-1">
    <section class="page-header">
      <div>
        <h1>Simulador Profissional de Juros Compostos</h1>
        <p class="muted">Ferramenta de alta precisão para planejamento financeiro e auditoria.</p>
      </div>
      <div class="controls-header">
        <button class="btn ghost" id="btnReset">Limpar</button>
        <button class="btn primary" id="btnNew">Nova Simulação</button>
      </div>
    </section>

    <div class="grid-layout">
      <!-- SIDEBAR: CONTROLS -->
      <aside class="sidebar">
        <form id="simForm" class="card" onsubmit="return false;">
          <h2 class="card-title"><i class="ri-settings-3-line"></i> Parâmetros</h2>

          <!-- Capital -->
          <div class="form-group">
            <label for="capital">Capital Inicial (PV)</label>
            <div class="input-wrapper">
              <input id="capital" type="number" min="0" step="0.01" value="10000" required />
              <span class="currency-symbol">Kz</span>
            </div>
          </div>

          <!-- Taxa -->
          <div class="form-group">
            <label for="rate">Taxa de Juros (%)</label>
            <div class="row-compact">
              <input id="rate" type="number" min="0" step="0.0001" value="12" required />
              <select id="compounding">
                <option value="anual" selected>a.a.</option>
                <option value="mensal">a.m.</option>
                <option value="diaria">a.d.</option>
                <option value="continua">Contínua</option>
              </select>
            </div>
            <div class="small muted">Nominal</div>
          </div>

          <!-- Prazo -->
          <div class="form-group">
            <label>Prazo / Duração</label>
            <div class="row-compact">
              <input id="period" type="number" min="1" step="1" value="10" required />
              <select id="periodUnit">
                <option value="anos" selected>Anos</option>
                <option value="meses">Meses</option>
              </select>
            </div>
          </div>

          <div class="form-group">
             <label for="startDate">Data de Início</label>
             <input id="startDate" type="date" />
          </div>

          <hr class="divider">

          <!-- Aportes -->
          <details open>
            <summary>Aportes Periódicos (PMT)</summary>
            <div class="details-content">
              <div class="form-group">
                <label for="contribution">Valor do Aporte</label>
                <input id="contribution" type="number" min="0" step="0.01" value="500" />
              </div>
              <div class="form-group">
                <label for="contributionFreq">Frequência</label>
                <select id="contributionFreq">
                  <option value="mensal" selected>Mensal</option>
                  <option value="anual">Anual</option>
                </select>
              </div>
              <div class="form-group">
                <label>Momento (Timing)</label>
                <div class="radio-group">
                  <label><input type="radio" name="timing" value="fim" checked> Fim (Ordinária)</label>
                  <label><input type="radio" name="timing" value="inicio"> Início (Antecipada)</label>
                </div>
              </div>
            </div>
          </details>

          <hr class="divider">

          <!-- Avançado -->
          <details>
            <summary>Avançado (Inflação & Moeda)</summary>
            <div class="details-content">
              <div class="form-group">
                <label for="inflation">Inflação Estimada (% a.a.)</label>
                <input id="inflation" type="number" min="0" step="0.01" value="5" />
              </div>
              <div class="form-group">
                <label for="localeCurrency">Moeda / Formato</label>
                <select id="localeCurrency">
                  <option value="pt-AO|AOA" selected>Angola (AOA)</option>
                  <option value="pt-BR|BRL">Brasil (BRL)</option>
                  <option value="en-US|USD">EUA (USD)</option>
                  <option value="pt-PT|EUR">Europa (EUR)</option>
                </select>
              </div>
            </div>
          </details>

          <div class="actions">
            <button class="btn primary full-width" id="btnCalculate" type="button">
              <i class="ri-calculator-line"></i> Calcular
            </button>
          </div>
        </form>
      </aside>

      <!-- MAIN: RESULTS -->
      <section class="results-area">
        <!-- KPI CARDS -->
        <div class="kpi-grid">
          <div class="kpi-card">
            <div class="kpi-label">Valor Futuro (Nominal)</div>
            <div class="kpi-value" id="finalAmount">---</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Valor Real (Ajustado)</div>
            <div class="kpi-value" id="finalRealAmount">---</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Total Investido</div>
            <div class="kpi-value" id="totalInvested">---</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Total Juros</div>
            <div class="kpi-value highlight" id="totalInterest">---</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Taxa Real</div>
            <div class="kpi-value" id="realRate">---</div>
          </div>
        </div>

        <!-- TABS -->
        <div class="tabs">
          <button class="tab-btn active" data-tab="chartTab">Gráfico</button>
          <button class="tab-btn" data-tab="tableTab">Tabela Detalhada</button>
          <button class="tab-btn" data-tab="auditTab">Auditoria</button>
        </div>

        <div class="tab-content" id="chartTab">
          <div class="chart-container">
            <canvas id="mainChart"></canvas>
          </div>
        </div>

        <div class="tab-content hidden" id="tableTab">
          <div class="toolbar">
             <button class="btn sm" id="btnExportCsv"><i class="ri-file-excel-line"></i> CSV</button>
             <button class="btn sm" id="btnExportPdf"><i class="ri-file-pdf-line"></i> PDF</button>
          </div>
          <div class="table-responsive">
            <table id="scheduleTable" class="data-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Data</th>
                  <th>Saldo Inicial</th>
                  <th>Juros</th>
                  <th>Aporte</th>
                  <th>Saldo Final</th>
                  <th>Saldo Real</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="7" class="text-center muted">Clique em Calcular</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="tab-content hidden" id="auditTab">
          <div class="audit-log" id="auditLog">
            <p class="muted">Logs de cálculo aparecerão aqui.</p>
          </div>
        </div>

        <!-- Saved Scenarios -->
        <div class="saved-section">
            <h3><i class="ri-save-line"></i> Cenários Salvos</h3>
            <div class="save-controls">
                <input id="saveName" type="text" placeholder="Nome do cenário..." />
                <button class="btn secondary" id="btnSaveScenario">Salvar Atual</button>
            </div>
            <div id="savedList" class="saved-list"></div>
        </div>

      </section>
    </div>
  </main>

<script type="module">
  import { requireAuth, logout } from '../js/auth.js';

  const session = requireAuth();

  if (session) {
      // Update UI with user name
      const navList = document.querySelector('.nav__list');
      // Replace "Sobre" with User info
      const userItem = document.createElement('li');
      userItem.innerHTML = `<span class="nav__link" style="cursor:default">Olá, ${session.name}</span>`;

      const logoutItem = document.createElement('li');
      logoutItem.innerHTML = `<a href="#" class="nav__link" id="btnLogout">Sair</a>`;

      // Clear existing list or append? Let's append/replace
      // Ideally we should have a dedicated place.
      // Let's just add them to the end.
      navList.appendChild(userItem);
      navList.appendChild(logoutItem);

      document.getElementById('btnLogout').addEventListener('click', (e) => {
          e.preventDefault();
          logout();
      });
  }
</script>
<script type="module" src="../js/main.js"></script>
<script src="../js/dropdowns.js"></script>

</body>
</html>
